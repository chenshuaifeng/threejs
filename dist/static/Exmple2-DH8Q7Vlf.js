import{C as j,L as G,F as V,B as k,k as _,c as F,P as U,W as H,l as D,m as O,n as T,j as I,o as Y,p as X,T as Z,q as A,S as q,r as W,s as $}from"./three.module-B48SNEox.js";import{d as J}from"./dat.gui.module-DqesmVVB.js";import{_ as K}from"./index-HC9wGKDV.js";import{O as Q}from"./OrbitControls-BQkA2Aq0.js";import{r as N,d as E,m as ee,p as te,q as ne}from"./vue-SvvCd1mE.js";import"./element-C1lpoOYO.js";import"./vxe-YBxjpzKi.js";const h=new j;class se extends G{constructor(u){super(u),this.propertyNameMapping={},this.customPropertyMapping={}}load(u,S,f,y){const d=this,g=new V(this.manager);g.setPath(this.path),g.setResponseType("arraybuffer"),g.setRequestHeader(this.requestHeader),g.setWithCredentials(this.withCredentials),g.load(u,function(C){try{S(d.parse(C))}catch(M){y?y(M):console.error(M),d.manager.itemError(u)}},f,y)}setPropertyNameMapping(u){this.propertyNameMapping=u}setCustomPropertyNameMapping(u){this.customPropertyMapping=u}parse(u){function S(e,r=0){const n=/^ply([\s\S]*)end_header(\r\n|\r|\n)/;let t="";const o=n.exec(e);o!==null&&(t=o[1]);const s={comments:[],elements:[],headerLength:r,objInfo:""},i=t.split(/\r\n|\r|\n/);let a;function x(p,m){const c={type:p[0]};return c.type==="list"?(c.name=p[3],c.countType=p[1],c.itemType=p[2]):c.name=p[1],c.name in m&&(c.name=m[c.name]),c}for(let p=0;p<i.length;p++){let m=i[p];if(m=m.trim(),m==="")continue;const c=m.split(/\s+/),b=c.shift();switch(m=c.join(" "),b){case"format":s.format=c[0],s.version=c[1];break;case"comment":s.comments.push(m);break;case"element":a!==void 0&&s.elements.push(a),a={},a.name=c[0],a.count=parseInt(c[1]),a.properties=[];break;case"property":a.properties.push(x(c,w.propertyNameMapping));break;case"obj_info":s.objInfo=m;break;default:}}return a!==void 0&&s.elements.push(a),s}function f(e,r){switch(r){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function y(e,r){const n={};for(let t=0;t<e.length;t++){if(r.empty())return null;if(e[t].type==="list"){const o=[],s=f(r.next(),e[t].countType);for(let i=0;i<s;i++){if(r.empty())return null;o.push(f(r.next(),e[t].itemType))}n[e[t].name]=o}else n[e[t].name]=f(r.next(),e[t].type)}return n}function d(){const e={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[],faceVertexColors:[]};for(const r of Object.keys(w.customPropertyMapping))e[r]=[];return e}function g(e){const r=e.map(t=>t.name);function n(t){for(let o=0,s=t.length;o<s;o++){const i=t[o];if(r.includes(i))return i}return null}return{attrX:n(["x","px","posx"])||"x",attrY:n(["y","py","posy"])||"y",attrZ:n(["z","pz","posz"])||"z",attrNX:n(["nx","normalx"]),attrNY:n(["ny","normaly"]),attrNZ:n(["nz","normalz"]),attrS:n(["s","u","texture_u","tx"]),attrT:n(["t","v","texture_v","ty"]),attrR:n(["red","diffuse_red","r","diffuse_r"]),attrG:n(["green","diffuse_green","g","diffuse_g"]),attrB:n(["blue","diffuse_blue","b","diffuse_b"])}}function C(e,r){const n=d(),t=/end_header\s+(\S[\s\S]*\S|\S)\s*$/;let o,s;(s=t.exec(e))!==null?o=s[1].split(/\s+/):o=[];const i=new re(o);e:for(let a=0;a<r.elements.length;a++){const x=r.elements[a],p=g(x.properties);for(let m=0;m<x.count;m++){const c=y(x.properties,i);if(!c)break e;v(n,x.name,c,p)}}return M(n)}function M(e){let r=new k;e.indices.length>0&&r.setIndex(e.indices),r.setAttribute("position",new _(e.vertices,3)),e.normals.length>0&&r.setAttribute("normal",new _(e.normals,3)),e.uvs.length>0&&r.setAttribute("uv",new _(e.uvs,2)),e.colors.length>0&&r.setAttribute("color",new _(e.colors,3)),(e.faceVertexUvs.length>0||e.faceVertexColors.length>0)&&(r=r.toNonIndexed(),e.faceVertexUvs.length>0&&r.setAttribute("uv",new _(e.faceVertexUvs,2)),e.faceVertexColors.length>0&&r.setAttribute("color",new _(e.faceVertexColors,3)));for(const n of Object.keys(w.customPropertyMapping))e[n].length>0&&r.setAttribute(n,new _(e[n],w.customPropertyMapping[n].length));return r.computeBoundingSphere(),r}function v(e,r,n,t){if(r==="vertex"){e.vertices.push(n[t.attrX],n[t.attrY],n[t.attrZ]),t.attrNX!==null&&t.attrNY!==null&&t.attrNZ!==null&&e.normals.push(n[t.attrNX],n[t.attrNY],n[t.attrNZ]),t.attrS!==null&&t.attrT!==null&&e.uvs.push(n[t.attrS],n[t.attrT]),t.attrR!==null&&t.attrG!==null&&t.attrB!==null&&(h.setRGB(n[t.attrR]/255,n[t.attrG]/255,n[t.attrB]/255).convertSRGBToLinear(),e.colors.push(h.r,h.g,h.b));for(const o of Object.keys(w.customPropertyMapping))for(const s of w.customPropertyMapping[o])e[o].push(n[s])}else if(r==="face"){const o=n.vertex_indices||n.vertex_index,s=n.texcoord;o.length===3?(e.indices.push(o[0],o[1],o[2]),s&&s.length===6&&(e.faceVertexUvs.push(s[0],s[1]),e.faceVertexUvs.push(s[2],s[3]),e.faceVertexUvs.push(s[4],s[5]))):o.length===4&&(e.indices.push(o[0],o[1],o[3]),e.indices.push(o[1],o[2],o[3])),t.attrR!==null&&t.attrG!==null&&t.attrB!==null&&(h.setRGB(n[t.attrR]/255,n[t.attrG]/255,n[t.attrB]/255).convertSRGBToLinear(),e.faceVertexColors.push(h.r,h.g,h.b),e.faceVertexColors.push(h.r,h.g,h.b),e.faceVertexColors.push(h.r,h.g,h.b))}}function L(e,r){const n={};let t=0;for(let o=0;o<r.length;o++){const s=r[o],i=s.valueReader;if(s.type==="list"){const a=[],x=s.countReader.read(e+t);t+=s.countReader.size;for(let p=0;p<x;p++)a.push(i.read(e+t)),t+=i.size;n[s.name]=a}else n[s.name]=i.read(e+t),t+=i.size}return[n,t]}function R(e,r,n){function t(o,s,i){switch(s){case"int8":case"char":return{read:a=>o.getInt8(a),size:1};case"uint8":case"uchar":return{read:a=>o.getUint8(a),size:1};case"int16":case"short":return{read:a=>o.getInt16(a,i),size:2};case"uint16":case"ushort":return{read:a=>o.getUint16(a,i),size:2};case"int32":case"int":return{read:a=>o.getInt32(a,i),size:4};case"uint32":case"uint":return{read:a=>o.getUint32(a,i),size:4};case"float32":case"float":return{read:a=>o.getFloat32(a,i),size:4};case"float64":case"double":return{read:a=>o.getFloat64(a,i),size:8}}}for(let o=0,s=e.length;o<s;o++){const i=e[o];i.type==="list"?(i.countReader=t(r,i.countType,n),i.valueReader=t(r,i.itemType,n)):i.valueReader=t(r,i.type,n)}}function B(e,r){const n=d(),t=r.format==="binary_little_endian",o=new DataView(e,r.headerLength);let s,i=0;for(let a=0;a<r.elements.length;a++){const x=r.elements[a],p=x.properties,m=g(p);R(p,o,t);for(let c=0;c<x.count;c++){s=L(i,p),i+=s[1];const b=s[0];v(n,x.name,b,m)}}return M(n)}function P(e){let r=0,n=!0,t="";const o=[],s=new TextDecoder().decode(e.subarray(0,5)),i=/^ply\r\n/.test(s);do{const a=String.fromCharCode(e[r++]);a!==`
`&&a!=="\r"?t+=a:(t==="end_header"&&(n=!1),t!==""&&(o.push(t),t=""))}while(n&&r<e.length);return i===!0&&r++,{headerText:o.join("\r")+"\r",headerLength:r}}let l;const w=this;if(u instanceof ArrayBuffer){const e=new Uint8Array(u),{headerText:r,headerLength:n}=P(e),t=S(r,n);if(t.format==="ascii"){const o=new TextDecoder().decode(e);l=C(o,t)}else l=B(u,t)}else l=C(u,S(u));return l}}class re{constructor(u){this.arr=u,this.i=0}empty(){return this.i>=this.arr.length}next(){return this.arr[this.i++]}}const oe=Object.assign({name:"Exmple2"},{__name:"Exmple2",setup(z){let u=0,S=0;const f=new F;f.castShadow=!0;const y=new U(45,window.innerWidth/window.innerHeight,.1,2e3);y.position.set(6.312546219397561,4.2,-2);const d=new H({antialias:!0});d.shadowMap.enabled=!0,d.shadowMap.type=D,d.toneMapping=O,d.toneMappingExposure=1;const g=new Q(y,d.domElement);g.minDistance=2,g.maxDistance=10,g.maxPolarAngle=Math.PI/2,new se().load("model/exmple2/Lucy100k.ply",s=>{s.scale(.0024,.0024,.0024),s.computeVertexNormals();const i=new T,a=new I(s,i);a.receiveShadow=!0,a.castShadow=!0,f.add(a)});const C=new Y(50,50),M=new T({color:12369084}),v=new I(C,M);v.rotation.x=-Math.PI/2,v.position.set(0,-2,0),v.receiveShadow=!0,f.add(v);const L=new X(16777215,9276813,.15);f.add(L);const R=["disturb.jpg","colors.png","uv_grid_opengl.jpg"],B=new Z().setPath("model/exmple2/"),P={none:null};for(let s=0;s<R.length;s++){const i=R[s],a=B.load(i);a.minFilter=A,a.magFilter=A,a.colorSpace=q,P[i]=a}const l=new W(16777215,100);l.position.set(2.5,5,2.5),l.angle=Math.PI/6,l.penumbra=1,l.decay=2,l.distance=0,l.map=P["disturb.jpg"],l.castShadow=!0,l.shadow.mapSize.width=1024,l.shadow.mapSize.height=1024,l.shadow.camera.near=1,l.shadow.camera.far=20,l.shadow.focus=1,f.add(l);const w=new $(l);f.add(w);const e=N(),r=N(),n=new J.GUI;n.addFolder("threjs配置").open();const t={roughness:0,metalness:.2,lightProbeIntensity:1,directionalLight:.6};n.add(t,"roughness",0,1,.01).name("roughness").onChange(()=>{});const o=()=>{const s=performance.now()/3e3;return l.position.x=Math.cos(s)*2.5,l.position.z=Math.sin(s)*2.5,w.update(),d.setSize(u,S),y.updateProjectionMatrix(),g.update(),d.render(f,y)};return E(()=>{var i;const s=e.value.getBoundingClientRect();u=s.width,S=s.height,d.setSize(u,S),d.setAnimationLoop(o),e.value.appendChild(d.domElement),(i=r.value)==null||i.appendChild(n.domElement)}),(s,i)=>(ee(),te("div",{ref_key:"sceneRef",ref:e,class:"right-box"},[ne("div",{ref_key:"guiRef",ref:r,id:"gui",class:"gui-box"},null,512)],512))}}),me=K(oe,[["__scopeId","data-v-370a956b"]]);export{me as default};
